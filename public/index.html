<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>VSCodium Web</title>
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Ce script active les fonctionnalités de sécurité nécessaires pour Node.js/Streams -->
    <script src="./coi-serviceworker.min.js"></script>
    <!-- CSS -->
    <link id="favicon" rel="icon" type="image/x-icon" />
    <link rel="stylesheet" id="workbench-css">
</head>

<body>
</body>

<!-- Configuration Script -->
<script>
    // --- 1. CALCUL DU CHEMIN ABSOLU (Correction des erreurs 404) ---
    // On récupère l'URL complète du dossier courant (ex: https://user.github.io/repo)
    // Cela empêche le navigateur de chercher à la racine du domaine.
    const url = new URL(window.location.href);
    const path = url.pathname.endsWith('/') ? url.pathname : url.pathname + '/';
    const baseUrl = url.origin + path;

    // Définition des chemins pour les icones et CSS dynamiquement
    document.getElementById('favicon').href = baseUrl + 'favicon.ico';
    document.getElementById('workbench-css').href = baseUrl + 'out/vs/code/browser/workbench/workbench.css';

    // --- 2. CONFIGURATION VSCODE GLOBALE ---
    // Indique à VSCode où trouver le dossier 'out' de manière absolue
    globalThis._VSCODE_FILE_ROOT = baseUrl + 'out/';
    
    // --- 3. CONFIGURATION DU WORKBENCH ---
    const webConfiguration = {
        // IMPORTANT : On retire 'folderUri' pour éviter l'erreur "memfs" au démarrage.
        // L'éditeur s'ouvrira en mode "Fenêtre vide" (fonctionnel).
        // folderUri: { scheme: 'memfs', path: '/code' }, 

        productConfiguration: {
            nameShort: "VSCodium",
            nameLong: "VSCodium Web",
            applicationName: "code-oss",
            dataFolderName: ".vscode-oss",
            // URL pour télécharger les extensions (Open VSX pour VSCodium)
            extensionsGallery: {
                serviceUrl: "https://open-vsx.org/vscode/gallery",
                itemUrl: "https://open-vsx.org/vscode/item",
                resourceUrlTemplate: "https://open-vsx.org/vscode/unpkg/{publisher}/{name}/{version}/{path}"
            }
        },
        // Configuration additionnelle pour aider à trouver les assets
        additionalBuiltinExtensions: [
            {
                // Scheme: http ou https selon l'endroit où vous êtes
                scheme: url.protocol.replace(':', ''), 
                // Authority: le domaine (ex: davy39.github.io)
                authority: url.host, 
                // Path: le chemin vers le dossier extrait par l'action GitHub
                path: path + 'extensions/start-webcontainer'
            }
        ]
    };

    // Injection de la config dans les Meta Tags
    const metaConfig = document.createElement('meta');
    metaConfig.id = 'vscode-workbench-web-configuration';
    metaConfig.setAttribute('data-settings', JSON.stringify(webConfiguration));
    document.head.appendChild(metaConfig);

    const metaAuth = document.createElement('meta');
    metaAuth.id = 'vscode-workbench-auth-session';
    metaAuth.setAttribute('data-settings', '');
    document.head.appendChild(metaAuth);

</script>

<!-- --- 4. CHARGEMENT DES SCRIPTS --- -->
<!-- On utilise des chemins absolus calculés pour être sûr que ça charge -->
<script>
    const nlsUrl = baseUrl + 'out/nls.messages.js';
    const workbenchUrl = baseUrl + 'out/vs/code/browser/workbench/workbench.js';

    // Chargement dynamique pour utiliser la variable baseUrl
    const scriptNLS = document.createElement('script');
    scriptNLS.type = 'module';
    scriptNLS.src = nlsUrl;
    document.head.appendChild(scriptNLS);

    const scriptWorkbench = document.createElement('script');
    scriptWorkbench.type = 'module';
    scriptWorkbench.src = workbenchUrl;
    scriptWorkbench.async = true;
    document.body.appendChild(scriptWorkbench);
</script>
</html>